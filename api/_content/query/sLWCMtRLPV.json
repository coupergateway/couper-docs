[{"_path":"/configuration/block/api","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"API","description":"The api block bundles endpoints under a certain base_path.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"api"},"children":[{"type":"text","value":"API"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"api"}]},{"type":"text","value":" block bundles endpoints under a certain "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"base_path"}]},{"type":"text","value":"."}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If an error occurred for api endpoints the response gets processed\nas JSON error with an error body payload. This can be customized via "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"error_file"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Block name"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Context"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Label"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"api"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"a","props":{"href":"/configuration/block/server"},"children":[{"type":"text","value":"Server Block"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"Optional"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"attribute-allowed_methods"},"children":[{"type":"text","value":"Attribute "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"allowed_methods"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The default value "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"*"}]},{"type":"text","value":" can be combined with additional methods. Methods are matched case-insensitively. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Access-Control-Allow-Methods"}]},{"type":"text","value":" is only sent in response to a "},{"type":"element","tag":"a","props":{"href":"/configuration/block/cors"},"children":[{"type":"text","value":"CORS"}]},{"type":"text","value":" preflight request, if the method requested by "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Access-Control-Request-Method"}]},{"type":"text","value":" is an allowed method."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"text","value":" "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"allowed_methods = [\"GET\", \"POST\"]"}]},{"type":"text","value":" or "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"allowed_methods = [\"*\", \"BREW\"]"}]}]},{"type":"element","tag":"h3","props":{"id":"attribute-required_permission"},"children":[{"type":"text","value":"Attribute "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"required_permission"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the value is a string, the same permission applies to all request methods. If there are different permissions for different request methods, use an object with the request methods as keys and string values. Methods not specified in this object are not permitted. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"\"*\""}]},{"type":"text","value":" is the key for \"all other standard methods\". Methods other than "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"GET"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"HEAD"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"POST"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"PUT"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"PATCH"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"DELETE"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"OPTIONS"}]},{"type":"text","value":" must be specified explicitly. A value "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"\"\""}]},{"type":"text","value":" means \"no permission required\"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Example:"}]}]},{"type":"element","tag":"code","props":{"code":"required_permission = \"read\"\n# or\nrequired_permission = { post = \"write\", \"*\" = \"\" }\n# or\nrequired_permission = default(request.path_params.p, \"not_set\")\n","language":"hcl"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"required_permission = \"read\"\n# or\nrequired_permission = { post = \"write\", \"*\" = \"\" }\n# or\nrequired_permission = default(request.path_params.p, \"not_set\")\n"}]}]}]},{"type":"element","tag":"attributes","props":{":values":"[{\"default\":\"[]\",\"description\":\"Sets predefined [access control](/configuration/access-control) for this block.\",\"name\":\"access_control\",\"type\":\"tuple (string)\"},{\"default\":\"\",\"description\":\"Key/value pairs to add as response headers in the client response.\",\"name\":\"add_response_headers\",\"type\":\"object\"},{\"default\":\"*\",\"description\":\"Sets allowed methods as _default_ for all contained endpoints. Requests with a method that is not allowed result in an error response with a `405 Method Not Allowed` status.\",\"name\":\"allowed_methods\",\"type\":\"tuple (string)\"},{\"default\":\"\",\"description\":\"Configures the path prefix for all requests.\",\"name\":\"base_path\",\"type\":\"string\"},{\"default\":\"\",\"description\":\"Log fields for [custom logging](/observation/logging#custom-logging). Inherited by nested blocks.\",\"name\":\"custom_log_fields\",\"type\":\"object\"},{\"default\":\"[]\",\"description\":\"Disables access controls by name.\",\"name\":\"disable_access_control\",\"type\":\"tuple (string)\"},{\"default\":\"\",\"description\":\"Location of the error file template.\",\"name\":\"error_file\",\"type\":\"string\"},{\"default\":\"[]\",\"description\":\"List of names to remove headers from the client response.\",\"name\":\"remove_response_headers\",\"type\":\"tuple (string)\"},{\"default\":\"\",\"description\":\"Permission required to use this API (see [error type](/configuration/error-handling#error-types) `insufficient_permissions`).\",\"name\":\"required_permission\",\"type\":\"string or object (string)\"},{\"default\":\"\",\"description\":\"Key/value pairs to set as response headers in the client response.\",\"name\":\"set_response_headers\",\"type\":\"object\"}]"},"children":[]},{"type":"element","tag":"blocks","props":{":values":"[{\"description\":\"Configures [CORS](/configuration/block/cors) settings (zero or one).\",\"name\":\"cors\"},{\"description\":\"Configures an [endpoint](/configuration/block/endpoint) (zero or more).\",\"name\":\"endpoint\"},{\"description\":\"Configures an [error handler](/configuration/block/error_handler) (zero or more).\",\"name\":\"error_handler\"}]"},"children":[]}]},"_type":"markdown","_id":"content:2.configuration:4.block:api.md","_source":"content","_file":"2.configuration/4.block/api.md","_extension":"md"},{"_path":"/configuration/block/backend","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Backend","description":"The backend defines the connection pool with given origin for outgoing connections.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"backend"},"children":[{"type":"text","value":"Backend"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"backend"}]},{"type":"text","value":" block defines the connection to a local/remote backend service."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Backends can be defined in the "},{"type":"element","tag":"a","props":{"href":"/configuration/block/definitions"},"children":[{"type":"text","value":"Definitions Block"}]},{"type":"text","value":" and referenced by "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"label"}]},{"type":"text","value":"."}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Block name"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Context"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Label"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"backend"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"a","props":{"href":"/configuration/block/definitions"},"children":[{"type":"text","value":"Definitions Block"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"/configuration/block/proxy"},"children":[{"type":"text","value":"Proxy Block"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"/configuration/block/request"},"children":[{"type":"text","value":"Request Block"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"/configuration/block/oauth2req_auth"},"children":[{"type":"text","value":"OAuth2 CC Block"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"/configuration/block/jwt"},"children":[{"type":"text","value":"JWT Block"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"/configuration/block/beta_oauth2"},"children":[{"type":"text","value":"OAuth2 AC (Beta) Block"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"/configuration/block/oidc"},"children":[{"type":"text","value":"OIDC Block"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"âš  required, if defined in "},{"type":"element","tag":"a","props":{"href":"/configuration/block/definitions"},"children":[{"type":"text","value":"Definitions Block"}]}]}]}]}]},{"type":"element","tag":"attributes","props":{":values":"[{\"default\":\"\",\"description\":\"Key/value pairs to add form parameters to the upstream request body.\",\"name\":\"add_form_params\",\"type\":\"object\"},{\"default\":\"\",\"description\":\"Key/value pairs to add query parameters to the upstream request URL.\",\"name\":\"add_query_params\",\"type\":\"object\"},{\"default\":\"\",\"description\":\"Key/value pairs to add as request headers in the upstream request.\",\"name\":\"add_request_headers\",\"type\":\"object\"},{\"default\":\"\",\"description\":\"Key/value pairs to add as response headers in the client response.\",\"name\":\"add_response_headers\",\"type\":\"object\"},{\"default\":\"\",\"description\":\"Basic auth for the upstream request with format `user:pass`.\",\"name\":\"basic_auth\",\"type\":\"string\"},{\"default\":\"\\\"10s\\\"\",\"description\":\"The total timeout for dialing and connect to the origin.\",\"name\":\"connect_timeout\",\"type\":\"duration\"},{\"default\":\"\",\"description\":\"Log fields for [custom logging](/observation/logging#custom-logging). Inherited by nested blocks.\",\"name\":\"custom_log_fields\",\"type\":\"object\"},{\"default\":\"false\",\"description\":\"Disables the peer certificate validation. Must not be used in backend refinement.\",\"name\":\"disable_certificate_validation\",\"type\":\"bool\"},{\"default\":\"false\",\"description\":\"Disables reusage of connections to the origin. Must not be used in backend refinement.\",\"name\":\"disable_connection_reuse\",\"type\":\"bool\"},{\"default\":\"\",\"description\":\"Value of the HTTP host header field for the origin request. Since hostname replaces the request host the value will also be used for a server identity check during a TLS handshake with the origin.\",\"name\":\"hostname\",\"type\":\"string\"},{\"default\":\"false\",\"description\":\"Enables the HTTP2 support. Must not be used in backend refinement.\",\"name\":\"http2\",\"type\":\"bool\"},{\"default\":\"0\",\"description\":\"The maximum number of concurrent connections in any state (_active_ or _idle_) to the origin. Must not be used in backend refinement.\",\"name\":\"max_connections\",\"type\":\"number\"},{\"default\":\"\",\"description\":\"URL to connect to for backend requests.\",\"name\":\"origin\",\"type\":\"string\"},{\"default\":\"\",\"description\":\"Changeable part of upstream URL.\",\"name\":\"path\",\"type\":\"string\"},{\"default\":\"\",\"description\":\"Prefixes all backend request paths with the given prefix.\",\"name\":\"path_prefix\",\"type\":\"string\"},{\"default\":\"\",\"description\":\"A proxy URL for the related origin request.\",\"name\":\"proxy\",\"type\":\"string\"},{\"default\":\"\",\"description\":\"List of names to remove form parameters from the upstream request body.\",\"name\":\"remove_form_params\",\"type\":\"object\"},{\"default\":\"[]\",\"description\":\"List of names to remove query parameters from the upstream request URL.\",\"name\":\"remove_query_params\",\"type\":\"tuple (string)\"},{\"default\":\"[]\",\"description\":\"List of names to remove headers from the upstream request.\",\"name\":\"remove_request_headers\",\"type\":\"tuple (string)\"},{\"default\":\"[]\",\"description\":\"List of names to remove headers from the client response.\",\"name\":\"remove_response_headers\",\"type\":\"tuple (string)\"},{\"default\":\"\",\"description\":\"Key/value pairs to set query parameters in the upstream request URL.\",\"name\":\"set_form_params\",\"type\":\"object\"},{\"default\":\"\",\"description\":\"Key/value pairs to set query parameters in the upstream request URL.\",\"name\":\"set_query_params\",\"type\":\"object\"},{\"default\":\"\",\"description\":\"Key/value pairs to set as request headers in the upstream request.\",\"name\":\"set_request_headers\",\"type\":\"object\"},{\"default\":\"\",\"description\":\"Key/value pairs to set as response headers in the client response.\",\"name\":\"set_response_headers\",\"type\":\"object\"},{\"default\":\"\",\"description\":\"Modifies the response status code.\",\"name\":\"set_response_status\",\"type\":\"number\"},{\"default\":\"\\\"300s\\\"\",\"description\":\"The total deadline duration a backend request has for write and read/pipe.\",\"name\":\"timeout\",\"type\":\"duration\"},{\"default\":\"\\\"60s\\\"\",\"description\":\"The duration from writing the full request to the origin and receiving the answer.\",\"name\":\"ttfb_timeout\",\"type\":\"duration\"},{\"default\":\"false\",\"description\":\"Ignores the health state and continues with the outgoing request.\",\"name\":\"use_when_unhealthy\",\"type\":\"bool\"}]"},"children":[]},{"type":"element","tag":"duration","props":{},"children":[]},{"type":"element","tag":"blocks","props":{":values":"[{\"description\":\"Configures a [health check](/configuration/block/health) (zero or one).\",\"name\":\"beta_health\"},{\"description\":\"Configures [rate limiting](/configuration/block/rate_limit) (zero or one).\",\"name\":\"beta_rate_limit\"},{\"description\":\"Configures a [token request authorization](/configuration/block/token_request) (zero or more).\",\"name\":\"beta_token_request\"},{\"description\":\"Configures an [OAuth2 authorization](/configuration/block/oauth2) (zero or one).\",\"name\":\"oauth2\"},{\"description\":\"Configures [OpenAPI validation](/configuration/block/openapi) (zero or one).\",\"name\":\"openapi\"},{\"description\":\"Configures [backend TLS](/configuration/block/backend_tls) (zero or one).\",\"name\":\"tls\"}]"},"children":[]},{"type":"element","tag":"h2","props":{"id":"refining-a-referenced-backend"},"children":[{"type":"text","value":"Refining a referenced backend"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Referenced backends may be \"refined\" by using a labeled "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"backend"}]},{"type":"text","value":" block in places where an unlabeled "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"backend"}]},{"type":"text","value":" block would also be allowed, e.g. in a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"proxy"}]},{"type":"text","value":" block:"}]},{"type":"element","tag":"code","props":{"code":"    proxy {\n      backend \"ref_be\" {      # refine referenced backend\n        path = \"/b\"           # override existing attribute value\n        add_form_params = {   # set new attribute\n          # ...\n        }\n      }\n    }\n\n# ...\n\ndefinitions {\n  backend \"ref_be\" {\n    origin = \"https://example.com\"\n    path = \"/a\"\n  }\n}\n","language":"hcl"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"    proxy {\n      backend \"ref_be\" {      # refine referenced backend\n        path = \"/b\"           # override existing attribute value\n        add_form_params = {   # set new attribute\n          # ...\n        }\n      }\n    }\n\n# ...\n\ndefinitions {\n  backend \"ref_be\" {\n    origin = \"https://example.com\"\n    path = \"/a\"\n  }\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If an attribute is set in both the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"referenced"}]},{"type":"text","value":" and the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"refining"}]},{"type":"text","value":" block, the value in the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"refining"}]},{"type":"text","value":" block is used."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Note:"}]},{"type":"text","value":" Child "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"blocks"}]},{"type":"text","value":" and the following "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"attributes"}]},{"type":"text","value":" are not allowed in refining "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"backend"}]},{"type":"text","value":" blocks:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"disable_certificate_validation"}]},{"type":"text","value":","}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"disable_connection_reuse"}]},{"type":"text","value":","}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"http2"}]},{"type":"text","value":" and"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"max_connections"}]},{"type":"text","value":"."}]}]}]},"draft":false,"_type":"markdown","_id":"content:2.configuration:4.block:backend.md","_source":"content","_file":"2.configuration/4.block/backend.md","_extension":"md"}]